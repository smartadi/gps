clear all;
close all;
clc;

mu = 1;
a  = 1;
c = 1000;

S = [10000, 0, 0;
    0, 10000, 0;
    0, 0, 10000;
    10000, 10000, 10000];


% S2 = [1000, 0, 0;
%     0, 1000, 0;
%     0, 0, 1000;
%     1000, 1000, 1000;
%     1000, 1000, 0;
%     0, 1000, 1000;
%     1000, 0, 1000;
%     -1000, -1000, -1000];

xt = [1000,1000,1000];

t = vecnorm(S-xt,2,2)/c + [-0.1;0.1;-0.1;0];

% t = [ 9;
%     10;
%     10;
%     17.3205];

% t2 = [ 1;
%     1;
%     1;
%     1.73;
%     1.4142;
%     1.4142;
%     1.4142;
%     1.732];


x0 = [0;
    0;
    0];

x02 = [10;
    10;
    10];


rho = t*c;


z = [1100;
    1100;
    1100];

y = [120;
    120;
    120];




C = [eye(3),zeros(3,1)];

Y = z-y;

% R= 0.7:0.1:10;

R= 0.6544:0.0001:0.6546;



E=[];
X0=[];

for j =1:length(R)
    r = R(j)
    x0 = [0;
    0;
    0]

rho = t*c;

z = [1100;
    1100;
    1100];

y = [120;
    120;
    120];

% y = [100;
%     100;
%     100];
Q = [eye(4),zeros(4,3);
    zeros(3,4),r*eye(3)];
    
for i=1:1000
    S-x0';
    dp1 = vecnorm(S - x0',2,2) - c*t;
    dp2 = [dp1;
           -z+y+x0];

    % dp2 = vecnorm(S2 - x02',2,2) - c*t2; 

    A = [(x0(1)-S(1,1))/rho(1),(x0(2)-S(1,2))/rho(1),(x0(3)-S(1,3))/rho(1),c;
     (x0(1)-S(2,1))/rho(2),(x0(2)-S(2,2))/rho(2),(x0(3)-S(2,3))/rho(2),c;
     (x0(1)-S(3,1))/rho(3),(x0(2)-S(3,2))/rho(3),(x0(3)-S(3,3))/rho(3),c;
     (x0(1)-S(4,1))/rho(4),(x0(2)-S(4,2))/rho(4),(x0(3)-S(4,3))/rho(4),c];

    G = [A;
        C];

dx = inv(G'*Q*G)*G'*inv(Q)*dp2;
x0 = x0-dx(1:3);

end
Co = inv(G'*Q*G);
E = [E,eig(Co)];
%sum(eig(Co))


X0 = [X0,x0];
end

err = vecnorm(X0 - xt',2,1);
%%

p = sum(E,1);

figure()
plot(R,p)
title("lambda vs reg term")


figure()
plot(R,err)
title("error vs reg term")

%% Noise 